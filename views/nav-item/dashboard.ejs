<!-- Google Material Icons --> 
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!-- CSS -->
<link rel="stylesheet" href="/css/dashboard.css">

<!-- Main Content Wrapper -->
<div class="container-fluid px-3 px-md-4 py-4" style="background-color: #f1f3f6; min-height: 100vh;">

  <!-- Top: Greeting + Actions -->
  <div class="d-flex align-items-center gap-2 flex-grow-1 flex-shrink-1">
    <button class="btn d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas">
      <i class="bi bi-list fs-4"></i>
    </button>
  </div>

  <div class="d-flex align-items-center justify-content-between flex-wrap mb-4" style="width: 100%;">
    <h6 class="fw-semibold mb-0 text-truncate flex-grow-1" style="min-width: 0; font-size: 1.15rem;">Welcome, Damien!</h6>
    <div class="d-flex align-items-center gap-2 flex-shrink-0">
      <button class="btn p-0 border-0 bg-transparent position-relative">
        <span class="material-icons text-dark">notifications</span>
        <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-white rounded-circle"></span>
      </button>
      <button class="btn btn-outline-primary d-flex align-items-center gap-1 rounded-pill px-2 py-1">
        <span class="material-icons" style="font-size: 18px;">calendar_today</span>
        <span class="d-none d-sm-inline">Calendar</span>
      </button>
    </div>
  </div>

  <!-- Heading + Search -->
  <div class="d-flex flex-row justify-content-between align-items-center mb-4 flex-nowrap">
    <h6 class="fw-semibold text-muted mb-0 me-3">Pending leads</h6>
    <div style="width: 200px; min-width: 150px;">
      <div class="input-group shadow-sm rounded">
        <span class="input-group-text border-0 bg-transparent p-1 pe-2">
          <span class="material-icons text-muted" style="font-size: 20px;">search</span>
        </span>
        <input type="text" class="form-control border-0 bg-transparent shadow-none px-1" placeholder="Search leads">
      </div>
    </div>
  </div>

  <!-- Card List -->
   <div id="tabsContainer">
  <div class="mb-4">
    <div class="d-flex flex-column gap-3" id="leadCardList">

      <!-- Lead Cards with onclick and data attributes -->
      <div class="lead-card lead-row"
     data-id="74-05062025"
     data-submitDate="15 July 2025"
     data-name="John Deo"
     data-email="John.doe@example.com"
     data-phone="+345 87 123 4567"
     data-pickup="Skibbereen"
     data-destination="Ballydehob"
     data-date="25 Jul 2025 13:40"
     data-price="€250"
     data-people="12"
     data-departure-date="25 Jul"
     data-departure-time="13:40"
     data-return-date="25 Jul"
     data-return-time="22:40"
     data-passengers="12"
     data-price-estimate="€300"
     data-from-stops='[{"name":"Baltimore","duration":"10min"},{"name":"Lisheen","duration":"15min"}]'
     data-to-stops='[{"name":"Schull","duration":"20min"},{"name":"Lisheen","duration":"10min"}]'
     onclick="showDetails(this)">
  <div class="lead-info">
    <i class="text-primary bi bi-hourglass-split"></i>
    <span class="fw-semibold">Skibbereen</span>
    <span class="fw-semibold">
      <span class="material-icons text-primary" style="font-size:20px; margin-right:8px; vertical-align:middle;">arrow_forward</span>
      Ballydehob
    </span>
  </div>
  <div class="lead-meta">
    <span class="text-muted">25 Jul 2025 13:40</span>
    <span class="fw-medium">€250</span>
    <span class="d-flex align-items-center gap-1">
      <span>12</span>
      <span class="material-icons">groups</span>
    </span>
    <span class="material-icons text-primary">chevron_right</span>
  </div>
</div>

<!-- Card 2: Cork → Kinsale -->
<div class="lead-card lead-row"
     data-id="75-15062025"
     data-submitDate="15 July 2025"
     data-name="mohan Deo"
     data-email="mohan.doe@example.com"
     data-phone="+345 81 156 4567"
     data-pickup="Cork"
     data-destination="Kinsale"
     data-date="28 Jul 2025 11:05"
     data-price="€150"
     data-people="8"
     data-departure-date="28 Jul"
     data-departure-time="11:05"
     data-return-date="28 Jul"
     data-return-time="18:30"
     data-passengers="8"
     data-price-estimate="€180"
     data-from-stops='[{"name":"Douglas","duration":"10min"},{"name":"Carrigaline","duration":"10min"}]'
     data-to-stops='[{"name":"Ballinhassig","duration":"15min"}]'
     onclick="showDetails(this)">
  <div class="lead-info">
    <i class="text-primary bi bi-hourglass-split"></i>
    <span class="fw-semibold">Cork</span>
    <span class="fw-semibold">
      <span class="material-icons text-primary" style="font-size:20px; margin-right:8px; vertical-align:middle;">arrow_forward</span>
      Kinsale
    </span>
  </div>
  <div class="lead-meta">
    <span class="text-muted">28 Jul 2025 11:05</span>
    <span class="fw-medium">€150</span>
    <span class="d-flex align-items-center gap-1">
      <span>8</span>
      <span class="material-icons">groups</span>
    </span>
    <span class="material-icons text-primary">chevron_right</span>
  </div>
</div>

<!-- Card 3: Bantry → Goleen -->
<div class="lead-card lead-row"
     data-id="77-15062025"
     data-submitDate="25 July 2025"
     data-name="raj Deo"
     data-email="raj.doe@example.com"
     data-phone="+555 84 123 4567"
     data-pickup="Bantry"
     data-destination="Goleen"
     data-date="29 Jul 2025 16:45"
     data-price="€200"
     data-people="10"
     data-departure-date="29 Jul"
     data-departure-time="16:45"
     data-return-date="29 Jul"
     data-return-time="21:30"
     data-passengers="10"
     data-price-estimate="€230"
     data-from-stops='[{"name":"Durrus","duration":"10min"},{"name":"Toormore","duration":"10min"}]'
     data-to-stops='[{"name":"Schull","duration":"15min"}]'
     onclick="showDetails(this)">
  <div class="lead-info">
    <i class="text-primary bi bi-hourglass-split"></i>
    <span class="fw-semibold">Bantry</span>
    <span class="fw-semibold">
      <span class="material-icons text-primary" style="font-size:20px;margin-right:8px; vertical-align:middle;">arrow_forward</span>
      Goleen
    </span>
  </div>
  <div class="lead-meta">
    <span class="text-muted">29 Jul 2025 16:45</span>
    <span class="fw-medium">€200</span>
    <span class="d-flex align-items-center gap-1">
      <span>10</span>
      <span class="material-icons">groups</span>
    </span>
    <span class="material-icons text-primary">chevron_right</span>
  </div>
</div>
   
<% detailedTrips.forEach(({ trip, goingStops, returnStops, timing, user }) => { %>
  <div class="lead-card lead-row"
       data-id="<%= trip._id %>"
       data-submitDate="<%= String(new Date(trip.createdAt).getDate()).padStart(2, '0') %> <%= ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][new Date(trip.createdAt).getMonth()] %> <%= new Date(trip.createdAt).getFullYear() %>"
       data-name="<%= user?.fullName || '' %>"
       data-email="<%= user?.email || '' %>"
       data-phone="<%= user?.phoneNumber || '' %>"
       data-pickup="<%= trip.pickupLocation %>"
       data-status="<%= trip.status %>"

       data-destination="<%= trip.destinationLocation %>"
       data-date="<%= timing ? timing.departureDate + ' ' + timing.departureTime : '' %>"
       
       data-departure-date="<%= timing?.departureDate %>"
       data-departure-time="<%= timing?.departureTime %>"
       data-return-date="<%= timing?.returnDate %>"
       data-return-time="<%= timing?.returnTime %>"
       data-passengers="<%= trip.numberOfPeople %>"
       data-price-estimate="€120"
       data-from-stops='<%= JSON.stringify(goingStops.map(stop => ({ name: stop.name, duration: stop.duration }))) %>'
       data-to-stops='<%= JSON.stringify(returnStops.map(stop => ({ name: stop.name, duration: stop.duration }))) %>'>
    <div class="lead-info">
     <% if(trip.status === 'Accepted') { %>
    <span class="material-icons text-success">check_circle</span>
  <% } else if(trip.status === 'Rejected') { %>
    <i class="bi bi-x-circle-fill" style="font-size:20px;"></i>
  <% } else { %>
    <i class="text-primary bi bi-hourglass-split"></i>
  <% } %>
      <span class="fw-semibold"><%= trip.pickupLocation %></span>
      <span class="fw-semibold">
        <span class="material-icons text-primary" style="font-size:20px;margin-right:8px; vertical-align:middle;">arrow_forward</span>
        <%= trip.destinationLocation %>
      </span>
    </div>
    <div class="lead-meta">
      <span class="text-muted"><%= String(new Date(trip.createdAt).getDate()).padStart(2, '0') %> <%= ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][new Date(trip.createdAt).getMonth()] %> <%= new Date(trip.createdAt).getFullYear() %> <%= timing?.departureTime %></span>
      <span class="fw-medium">€120</span>
      <span class="d-flex align-items-center gap-1">
        <span><%= trip.passengerCount %></span>
        <span class="material-icons">groups</span>
      </span>
      <!-- Status display -->
          <% if(trip.status === 'Accepted') { %>
            <span class="badge bg-success">Accepted</span>
          <% } else if(trip.status === 'Rejected') { %>
            <span class="badge bg-danger">Rejected</span>
          <% } else { %>
            <span class="badge bg-warning text-dark">Pending</span>
          <% } %>
      <span class="material-icons text-primary">chevron_right</span>
    </div>
  </div>
<% }); %>
   </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs d-flex flex-wrap gap-2 mb-2">
    <button id="allBtn" class="btn btn-primary btn-sm rounded-pill px-3 filter-btn">All</button>
    <button id="acceptedBtn" class="btn btn-sm rounded-pill px-3 filter-btn">Accepted</button>
    <button id="scheduledBtn" class="btn btn-sm rounded-pill px-3 filter-btn">Scheduled</button>
    <button id="rejectedBtn" class="btn btn-sm rounded-pill px-3 filter-btn">Rejected</button>
  </div>

  <!-- Lead Rows -->
   <div id="otherContainer"> <!-- Accepted/Rejected ke liye -->
   <div class="tab-cards">
  <div class="d-flex flex-column gap-3">

   <div class="lead-card lead-row"
     data-id="96-95062025"
     data-submitDate="15 July 2025"
     data-name="shreya rao"
     data-email="shreya.rae@example.com"
     data-phone="+908 87 123 4567"
     data-pickup="Clonakilty"
     data-destination="Bandon"
     data-date="30 Jul 2025 09:00"
     data-price="€140"
     data-people="9"
     data-departure-date="30 Jul"
     data-departure-time="09:00"
     data-return-date="30 Jul"
     data-return-time="17:30"
     data-passengers="9"
     data-price-estimate="€170"
     data-from-stops='[{"name":"Timoleague","duration":"15min"},{"name":"Kilbrittain","duration":"10min"}]'
     data-to-stops='[{"name":"Innishannon","duration":"10min"}]'
     onclick="showDetails(this)">
  <div class="lead-info">
    <span class="material-icons text-success">check_circle</span>
    <span class="fw-semibold">Clonakilty</span>
    <span class="fw-semibold">
      <span class="material-icons text-primary" style="font-size:20px;margin-right:8px; vertical-align:middle;">arrow_forward</span>
      Bandon
    </span>
  </div>
  <div class="lead-meta">
    <span class="text-muted">30 Jul 2025 09:00</span>
    <span class="fw-medium">€140</span>
    <span class="d-flex align-items-center gap-1">
      <span>9</span>
      <span class="material-icons">groups</span>
    </span>
    <span class="badge bg-success">Accepted</span>
    <span class="material-icons text-primary">chevron_right</span>
  </div>
</div>

<!-- Card 5: Dunmanway → Macroom -->
<div class="lead-card lead-row"
    data-submitDate="15 July 2025"
     data-id="89-05062025"
     data-name="tasm Deo"
     data-email="tasm.doe@example.com"
     data-phone="+945 89 123 4567"
     data-pickup="Dunmanway"
     data-destination="Macroom"
     data-date="31 Jul 2025 10:30"
     data-price="€160"
     data-people="11"
     data-departure-date="31 Jul"
     data-departure-time="10:30"
     data-return-date="31 Jul"
     data-return-time="19:00"
     data-passengers="11"
     data-price-estimate="€200"
     data-from-stops='[{"name":"Ballineen","duration":"10min"},{"name":"Enniskeane","duration":"15min"}]'
     data-to-stops='[{"name":"Lissarda","duration":"10min"}]'
     onclick="showDetails(this)">
  <div class="lead-info">
    <i class="text-primary bi bi-calendar-check" style="font-size:20px;"></i>
    <span class="fw-semibold">Dunmanway</span>
    <span class="fw-semibold">
      <span class="material-icons text-primary" style="font-size:20px;margin-right:8px; vertical-align:middle;">arrow_forward</span>
      Macroom
    </span>
  </div>
  <div class="lead-meta">
    <span class="text-muted">31 Jul 2025 10:30</span>
    <span class="fw-medium">€160</span>
    <span class="d-flex align-items-center gap-1">
      <span>11</span>
      <span class="material-icons">groups</span>
    </span>
    <span class="badge bg-secondary">Scheduled</span>
    <span class="material-icons text-primary">chevron_right</span>
  </div>
</div>

<!-- Card 6: Rosscarbery → Leap -->
<div class="lead-card lead-row"
     data-submitDate="25 July 2025"
     data-id="90-05062025"
     data-name="chita Deo"
     data-email="chitra.deo@example.com"
     data-phone="+345 87 123 4567"
     data-pickup="Rosscarbery"
     data-destination="Leap"
     data-date="01 Aug 2025 12:00"
     data-price="€120"
     data-people="7"
     data-departure-date="01 Aug"
     data-departure-time="12:00"
     data-return-date="01 Aug"
     data-return-time="17:00"
     data-passengers="7"
     detailDistance="1100km"
     data-price-estimate="€4300"
     data-from-stops='[{"name":"Owenahincha","duration":"10min"},{"name":"Glandore","duration":"10min"}]'
     data-to-stops='[{"name":"Union Hall","duration":"10min"}]'
     onclick="showDetails(this)">
  <div class="lead-info">
    <i class="bi bi-x-circle-fill" style="font-size:20px;"></i>
    <span class="fw-semibold">Rosscarbery</span>
    <span class="fw-semibold">
      <span class="material-icons text-primary" style="font-size:20px;margin-right:8px; vertical-align:middle;">arrow_forward</span>
      Leap
    </span>
  </div>
  <div class="lead-meta">
    <span class="text-muted">01 Aug 2025 12:00</span>
    <span class="fw-medium">€120</span>
    <span class="d-flex align-items-center gap-1">
      <span>7</span>
      <span class="material-icons">groups</span>
    </span>
    <span class="badge bg-danger">Rejected</span>
    <span class="material-icons text-primary">chevron_right</span>
  </div>
</div>
  </div>
</div>

  </div>
</div>

<script>
  let selectedLeadCard = null;
  function showDetails(card) {
    selectedLeadCard = card;
    const submitDate = card.dataset.submitDate;
    const id = card.getAttribute('data-id');
    const pickup = card.dataset.pickup;
  const destination = card.dataset.destination;
  const departureDate = card.dataset.departureDate;
  const departureTime = card.dataset.departureTime;
  const returnDate = card.dataset.returnDate;
  const returnTime = card.dataset.returnTime;
  const passengers = card.dataset.passengers;
  const priceEstimate = card.dataset.priceEstimate;

  const fromStops = JSON.parse(card.dataset.fromStops || "[]");
  const toStops = JSON.parse(card.dataset.toStops || "[]");

    const fromStopsUl = document.getElementById('modalFromStops');
  fromStopsUl.innerHTML = '';
  fromStops.forEach(stop => {
    const li = document.createElement('li');
    li.textContent = `${stop.name} (${stop.duration})`;
    fromStopsUl.appendChild(li);
  });

  const toStopsUl = document.getElementById('modalToStops');
  toStopsUl.innerHTML = '';
  toStops.forEach(stop => {
    const li = document.createElement('li');
    li.textContent = `${stop.name} (${stop.duration})`;
    toStopsUl.appendChild(li);
  });

  const modalElement = document.getElementById('messageModal');
if(modalElement){
  const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
  modal.hide();
}

function updateCardStatus(card, newStatus) {
  const iconMap = {
    'Pending': 'bi-hourglass-split text-primary',
    'Accepted': 'bi-check2-circle text-success',
    'Rejected': 'bi-x-circle text-danger'
  };

  // update icon
  const icon = card.querySelector('i');
  icon.className = 'bi ' + iconMap[newStatus];

  // update data-status attribute
  card.dataset.status = newStatus;

  // optionally, move card to correct position in container
  const container = document.getElementById('cards-container');
  container.appendChild(card); // move card to end, you can customize order
}

  }
  document.addEventListener("DOMContentLoaded", function () {
  const leadCardList = document.querySelectorAll('.lead-card');
  const leadCardContainer = document.getElementById('leadCardList');   // upar wala
  const otherContainer = document.getElementById('otherContainer');   // neeche wala

  leadCardList.forEach(card => {
    const icon = card.querySelector('i.bi-hourglass-split'); // sirf hourglass icon check

    if (icon) {
      // Agar hourglass hai to upar hi rahe
      leadCardContainer.appendChild(card);
    } else {
      // Baaki sab neeche chale jayein
      otherContainer.querySelector('.tab-cards .d-flex').appendChild(card);
    }
  });
});

</script>
<script src="/js/dashboard.js"></script>
